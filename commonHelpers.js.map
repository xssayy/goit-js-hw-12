{"version":3,"file":"commonHelpers.js","sources":["../src/main.js"],"sourcesContent":["import SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\nimport iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\nimport axios from 'axios';\n\nexport const refs = {\n  form: document.querySelector('.form'),\n  gallery: document.querySelector('.gallery'),\n  loader: document.querySelector('.loader'),\n  loadMoreBtn: document.querySelector('.load-more-btn'),\n};\nconst { form, gallery, loader, loadMoreBtn } = refs;\n\nlet page;\nlet query;\nlet perPageValue = 15;\n\nform.addEventListener('submit', onFormSubmit);\nloadMoreBtn.addEventListener('click', onLoadMore);\n\nasync function onFormSubmit(e) {\n  e.preventDefault();\n  showLoader();\n\n  query = e.target.elements.input.value.toLowerCase().trim();\n  page = 1;\n\n  gallery.innerHTML = '';\n  if (query === '') {\n    showError('Поле не може бути порожнім.');\n    loadMoreBtn.classList.add('is-hidden');\n    hideLoader();\n    return;\n  }\n\n  const data = await getImages(query);\n  if (data.totalHits === 0) {\n    showError('Відсутні результати пошуку. Спробуйте ще раз!');\n    hideLoader();\n    loadMoreBtn.classList.add('is-hidden');\n    return;\n  }\n  renderImages(data);\n  checkLoadMore(data);\n\n  e.target.reset();\n  hideLoader();\n}\n\nasync function getImages(searchRequestValue) {\n  const params = {\n    key: '42321641-23e42709c41860fd235775557',\n    q: `${searchRequestValue}`\n      .split(' ')\n      .map(word => {\n        return word.toLowerCase().trim();\n      })\n      .join('+'),\n    image_type: 'photo',\n    orientation: 'horizontal',\n    safesearch: true,\n  };\n\n  const url = `https://pixabay.com/api/?key=${params.key}&q=${params.q}&image_type=${params.image_type}&orientation=${params.orientation}&safesearch=${params.safesearch}&page=${page}&per_page=${perPageValue}`;\n  const data = await axios.get(url);\n\n  return data.data;\n}\n\nasync function templateImage(data) {\n  //===============================================\n  const markup = data\n    .map(image => {\n      return `<li class=\"gallery-item\">\n <a href=\"${image.largeImageURL}\"> <img\n    class=\"galery-img\"\n    src=\"${image.webformatURL}\"\n    alt=\"${image.tags}\"\n\n    width=\"360\"\n    height=\"200px\"/>\n    </a>\n  <div class=\"description\">\n    <p class=\"description-item\">\n      Likes<span>${image.likes}</span>\n    </p>\n    <p class=\"description-item\">\n      Views<span>${image.views}</span>\n    </p>\n    <p class=\"description-item\">\n      Comments<span>${image.comments}</span>\n    </p>\n    <p class=\"description-item\">\n      Downloads<span>${image.downloads}</span>\n    </p>\n  </div>\n</li>`;\n    })\n    .join('');\n  return markup;\n}\n\nasync function renderImages(data) {\n  const markup = await templateImage(data.hits);\n  gallery.insertAdjacentHTML('beforeend', markup);\n  lightbox.refresh();\n}\n\nasync function onLoadMore() {\n  showLoader();\n  const data = await getImages(query);\n  checkLoadMore(data);\n  renderImages(data);\n  scrollPage();\n  hideLoader();\n}\n\nfunction checkLoadMore(data) {\n  const maxPage = Math.ceil(data.totalHits / perPageValue);\n\n  if (page >= maxPage) {\n    loadMoreBtn.classList.add('is-hidden');\n    showMessage(\"We're sorry, but you've reached the end of search results.\");\n    return;\n  } else if (page < maxPage) {\n    loadMoreBtn.classList.remove('is-hidden');\n    page++;\n    console.log('Max page: ', maxPage);\n    console.log('Page: ', page);\n  }\n}\n\nfunction scrollPage() {\n  const height = document\n    .querySelector('.gallery-item')\n    .getBoundingClientRect().height;\n\n  setTimeout(() => {\n    window.scrollBy({\n      top: height * 2,\n      behavior: 'smooth',\n    });\n  }, 100);\n}\n\nfunction showLoader() {\n  loader.classList.remove('is-hidden');\n}\n\nfunction hideLoader() {\n  loader.classList.add('is-hidden');\n}\n\nfunction showError(error) {\n  iziToast.error({\n    title: 'Помилка',\n    message: `${error}`,\n    position: 'topRight',\n  });\n}\nfunction showMessage(msg) {\n  iziToast.info({\n    title: '',\n    message: `${msg}`,\n    position: 'topRight',\n  });\n}\n\nvar lightbox = new SimpleLightbox('.gallery a', {\n  captionsData: 'alt',\n  captionDelay: 250,\n});\n\n// HELPERS: showError, showMessage, hideLoader, showLoader, scroll\n// LOAD_MORE: checkLoadMore, onLoadMore\n// RENDER: templateImage, renderImages, getImages\n"],"names":["refs","form","gallery","loader","loadMoreBtn","page","query","perPageValue","onFormSubmit","onLoadMore","showLoader","showError","hideLoader","data","getImages","renderImages","checkLoadMore","searchRequestValue","params","word","url","axios","templateImage","image","markup","lightbox","scrollPage","maxPage","showMessage","height","error","iziToast","msg","SimpleLightbox"],"mappings":"owBAOO,MAAMA,EAAO,CAClB,KAAM,SAAS,cAAc,OAAO,EACpC,QAAS,SAAS,cAAc,UAAU,EAC1C,OAAQ,SAAS,cAAc,SAAS,EACxC,YAAa,SAAS,cAAc,gBAAgB,CACtD,EACM,CAAE,KAAAC,EAAM,QAAAC,EAAS,OAAAC,EAAQ,YAAAC,CAAW,EAAKJ,EAE/C,IAAIK,EACAC,EACAC,EAAe,GAEnBN,EAAK,iBAAiB,SAAUO,CAAY,EAC5CJ,EAAY,iBAAiB,QAASK,CAAU,EAEhD,eAAeD,EAAa,EAAG,CAQ7B,GAPA,EAAE,eAAc,EAChBE,IAEAJ,EAAQ,EAAE,OAAO,SAAS,MAAM,MAAM,cAAc,OACpDD,EAAO,EAEPH,EAAQ,UAAY,GAChBI,IAAU,GAAI,CAChBK,EAAU,6BAA6B,EACvCP,EAAY,UAAU,IAAI,WAAW,EACrCQ,IACA,MACD,CAED,MAAMC,EAAO,MAAMC,EAAUR,CAAK,EAClC,GAAIO,EAAK,YAAc,EAAG,CACxBF,EAAU,+CAA+C,EACzDC,IACAR,EAAY,UAAU,IAAI,WAAW,EACrC,MACD,CACDW,EAAaF,CAAI,EACjBG,EAAcH,CAAI,EAElB,EAAE,OAAO,QACTD,GACF,CAEA,eAAeE,EAAUG,EAAoB,CAC3C,MAAMC,EAAS,CACb,IAAK,qCACL,EAAG,GAAGD,CAAkB,GACrB,MAAM,GAAG,EACT,IAAIE,GACIA,EAAK,cAAc,MAC3B,EACA,KAAK,GAAG,EACX,WAAY,QACZ,YAAa,aACb,WAAY,EAChB,EAEQC,EAAM,gCAAgCF,EAAO,GAAG,MAAMA,EAAO,CAAC,eAAeA,EAAO,UAAU,gBAAgBA,EAAO,WAAW,eAAeA,EAAO,UAAU,SAASb,CAAI,aAAaE,CAAY,GAG5M,OAFa,MAAMc,EAAM,IAAID,CAAG,GAEpB,IACd,CAEA,eAAeE,EAAcT,EAAM,CA8BjC,OA5BeA,EACZ,IAAIU,GACI;AAAA,YACDA,EAAM,aAAa;AAAA;AAAA,WAEpBA,EAAM,YAAY;AAAA,WAClBA,EAAM,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAOFA,EAAM,KAAK;AAAA;AAAA;AAAA,mBAGXA,EAAM,KAAK;AAAA;AAAA;AAAA,sBAGRA,EAAM,QAAQ;AAAA;AAAA;AAAA,uBAGbA,EAAM,SAAS;AAAA;AAAA;AAAA,MAIjC,EACA,KAAK,EAAE,CAEZ,CAEA,eAAeR,EAAaF,EAAM,CAChC,MAAMW,EAAS,MAAMF,EAAcT,EAAK,IAAI,EAC5CX,EAAQ,mBAAmB,YAAasB,CAAM,EAC9CC,EAAS,QAAO,CAClB,CAEA,eAAehB,GAAa,CAC1BC,IACA,MAAMG,EAAO,MAAMC,EAAUR,CAAK,EAClCU,EAAcH,CAAI,EAClBE,EAAaF,CAAI,EACjBa,IACAd,GACF,CAEA,SAASI,EAAcH,EAAM,CAC3B,MAAMc,EAAU,KAAK,KAAKd,EAAK,UAAYN,CAAY,EAEvD,GAAIF,GAAQsB,EAAS,CACnBvB,EAAY,UAAU,IAAI,WAAW,EACrCwB,EAAY,4DAA4D,EACxE,MACJ,MAAavB,EAAOsB,IAChBvB,EAAY,UAAU,OAAO,WAAW,EACxCC,IACA,QAAQ,IAAI,aAAcsB,CAAO,EACjC,QAAQ,IAAI,SAAUtB,CAAI,EAE9B,CAEA,SAASqB,GAAa,CACpB,MAAMG,EAAS,SACZ,cAAc,eAAe,EAC7B,sBAAqB,EAAG,OAE3B,WAAW,IAAM,CACf,OAAO,SAAS,CACd,IAAKA,EAAS,EACd,SAAU,QAChB,CAAK,CACF,EAAE,GAAG,CACR,CAEA,SAASnB,GAAa,CACpBP,EAAO,UAAU,OAAO,WAAW,CACrC,CAEA,SAASS,GAAa,CACpBT,EAAO,UAAU,IAAI,WAAW,CAClC,CAEA,SAASQ,EAAUmB,EAAO,CACxBC,EAAS,MAAM,CACb,MAAO,UACP,QAAS,GAAGD,CAAK,GACjB,SAAU,UACd,CAAG,CACH,CACA,SAASF,EAAYI,EAAK,CACxBD,EAAS,KAAK,CACZ,MAAO,GACP,QAAS,GAAGC,CAAG,GACf,SAAU,UACd,CAAG,CACH,CAEA,IAAIP,EAAW,IAAIQ,EAAe,aAAc,CAC9C,aAAc,MACd,aAAc,GAChB,CAAC"}